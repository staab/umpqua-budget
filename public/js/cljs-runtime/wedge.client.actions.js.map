{"version":3,"sources":["wedge/client/actions.cljs"],"mappings":";;;;AAMA,AAAA,AAEA,AAAA,AAAA,AAAAA,AAAMM;AAAN,AAAA,AAAAL,AAAA;AAAA,AAAA,AAAAC,AAAA,AAAA;AAAA,AAAA,AAAAC,AAAA;;AAAA,AAAA,AAAA,AAAAA,AAAAD;AAAA,AAAA,AAAAD,AAAA,AAAA,AAAAE;;AAAA,AAAA,AAAAA,AAAA;;;;AAAA;;;;AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAA,AAAA,AAAAI,AAAA,AAAAJ,AAAA,AAAA,AAAA,AAAA;AAAA,AAAA,AAAAK,AAAA,AAAA,AAAA,AAAAF;;;AAAA,AAAA,AAAA,AAAA,AAAME,AAAQM,AAAMC;AAApB,AACE,AAAAC,AAAA,AAAAC,AAA2BH;AAA3BE,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAE,AAAA,AAAAF,AAAA,AAAA,AAAA,AAAA,AAAAG,AAAAC,AAAAJ,AAAAA;AAAA,AAAAK,AAAAL,AAAA,AAAcM;AAAd,AACE,AAAM,AAAG,AAAAC,AAAID;AAAJ,AAAA,AAAAC;AAAAA;;AAAA;;AAAiB,AAAA,AAAAN,AAAA,AAAIO;AAA9B,AACE,AAAA,AAAA,AAAAP,AAACQ,AAAMX,AAAIY,AAAkBF;;AAC7B,AAACL,AAAMQ,AAAMZ;;AAFf;;;;AAFJ,AAAA,AAAA,AAAMP;;AAAN;AAAA,AAAA,AAAA,AAAAC,AAAMD;AAAN,AAAA,AAAAE,AAAA,AAAAC,AAAAF;AAAAA,AAAA,AAAAG,AAAAH;AAAA,AAAA,AAAAI,AAAA;AAAA,AAAA,AAAAA,AAAAH,AAAAD;;;AAAA,AAMA,AAAA,AAAMmB,AAAUd,AAAIe;AAApB,AACE,AAAA,AAAA,AAAA,AAAA,AAAA,AAACC,AAAMhB,AAAIY,AAA4BG;;AAEzC,AAAA,AAAME,AAASjB,AAAIkB;AAAnB,AACE,AAAA,AAAA,AAAA,AAAA,AAAA,AAACF,AAAMhB,AAAIY,AAAuCM;;AAIpD,AAAA,AAAMC,AAAWC;AAAjB,AACE,AAAA,AAACT,AAAMU,AAAMT,AAAYQ;;AAE3B,AAAA,AAAME;AAAN,AACE,AAAA,AAACX,AAAMY,AAAQX,AAAaY;;AAE9B,AAAA,AAAMC;AAAN,AACE,AAAA,AAACd,AAAMe,AAAOd,AAAaY;;AAI7B,AAAA,AAAMG;AAAN,AACE,AAAA,AAAA,AAAA,AAAA,AAAAxB,AAACyB,AAAOC,AAA6BC;;AAEvC,AAAA,AAAMC,AAAiBC;AAAvB,AACE,AAAA,AAAA,AAAA,AAACnB,AAAqCmB;;AAExC,AAAA,AAAMC;AAAN,AACE,AAAOC;;AAIT,AAAAC,AAAA,AAAA,AAAAC;AAAA,AAAA,AAAAC,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAjC,AAAA,AAAAiC,AAAA,AAAA,AAAA,AAAA,AAAAhC,AAAAC,AAAA+B,AAAAA;AAAA,AAAA9B,AAAA8B,AAAA,AAAoDC;AAApD,AACE,AAACC,AAAMlB,AAAMmB,AAAMF;;AACnB,AAACG;;AAEH,AAAAN,AAAA,AAAA,AAAAO;AAAA,AAAA,AAAAC,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAvC,AAAA,AAAAuC,AAAA,AAAA,AAAA,AAAA,AAAAtC,AAAAC,AAAAqC,AAAAA;AAAA,AAAApC,AAAAoC,AAAA,AAAgDL;AAAhD,AACE,AAACxB,AAASe,AAAGS;;AAIf,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKM,AAMSb;AAEd,AAAKG,AAAc,AAASW,AAAS,AAACC,AAAQF","names":["var_args","args__4736__auto__","len__4730__auto__","i__4731__auto__","argseq__4737__auto__","cljs.core/IndexedSeq","wedge.client.actions/start!","seq25876","G__25877","cljs.core/first","cljs.core/next","self__4717__auto__","cur","args","map__25880","cljs.core/deref","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","last-load","or__4131__auto__","wedge.client.state/now","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","cljs.core/assoc","wedge.client.ws/send!","wedge.client.actions/resolve!","value","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$variadic","wedge.client.actions/reject!","error","wedge.client.actions/set-page!","page","wedge.client.state/state","wedge.client.actions/toggle-sidebar!","wedge.client.state/sidebar","cljs.core/not","wedge.client.actions/toggle-picker!","wedge.client.state/picker","wedge.client.actions/initialize!","wedge.client.actions.start_BANG_.cljs$core$IFn$_invoke$arity$variadic","wedge.client.state/db","wedge.client.state/session-id","wedge.client.actions/create-session!","v","wedge.client.actions/link-account!","wedge.client.actions/plaid-handler","wedge.client.ws/handle-message","p__25882","map__25883","payload","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3","cljs.core/merge","wedge.client.state/save-state!","p__25885","map__25886","wedge.client.actions/plaid-config","js/Plaid","cljs.core/clj->js"],"sourcesContent":["(ns wedge.client.actions\n  (:require [wedge.client.state\n             :refer [state state session-id save-state! now\n                     sidebar picker db]]\n            [wedge.client.ws :refer [send! handle-message]]))\n\n(declare plaid-handler)\n\n(defn start! [cur & args]\n  (let [{:keys [last-load]} @cur]\n    (when (< (or last-load 0) (- @now 5000))\n      (swap! cur assoc :last-load @now)\n      (apply send! args))))\n\n(defn resolve! [cur value]\n  (swap! cur assoc :last-load nil :value value :error nil))\n\n(defn reject! [cur error]\n  (swap! cur assoc :last-load nil :value nil :error error))\n\n;; UI actions\n\n(defn set-page! [page]\n  (swap! state assoc :page page))\n\n(defn toggle-sidebar! []\n  (swap! sidebar assoc :open? not))\n\n(defn toggle-picker! []\n  (swap! picker assoc :open? not))\n\n;; Data actions\n\n(defn initialize! []\n  (start! db :initialize {:session-id @session-id}))\n\n(defn create-session! [v]\n  (send! :create-session {:public-token v}))\n\n(defn link-account! []\n  (.open plaid-handler))\n\n;; Websocket handlers\n\n(defmethod handle-message :session-created [{:keys [payload]}]\n  (swap! state merge payload)\n  (save-state!))\n\n(defmethod handle-message :initialized [{:keys [payload]}]\n  (resolve! db payload))\n\n;; Plaid\n\n(def plaid-config\n  {:clientName \"Budgie\"\n   :env \"sandbox\"\n   :key \"10e3761c1655ff33ff9c5f410122ba\"\n   :product [\"transactions\"]\n   :webhook \"https://wedge.herokuapp.com\"\n   :onSuccess create-session!})\n\n(def plaid-handler (.create js/Plaid (clj->js plaid-config)))\n\n"]}